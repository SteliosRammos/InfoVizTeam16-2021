<!-- Range slider code -->
<script src="static/js/slider.js"></script>

<!-- Range slider style -->
<link href="static/js/slider.css" rel="stylesheet">
<h5>Date range</h5>
<div id="range-label"></div>
<div id="container"></div>

<div class="container-fluid">
    <div class="row">
        <nav class="col-2 bg-dark">
            <body>
                <label>Century:</label>
                <select id='century' , name='century' , onchange="submitSelected()">
                    <option value="">All</option>
                    <option value=-4.0>the 4th century BCE</option>
                    <option value=-3.0>the 3th century BCE</option>
                    <option value=9.0>the 9th century</option>
                    <option value=11.0>the 11th century</option>
                    <option value=13.0>the 13th century</option>
                    <option value=14.0>the 14th century</option>
                    <option value=15.0>the 15th century</option>
                    <option value=16.0>the 16th century</option>
                    <option value=17.0>the 17th century</option>
                    <option value=18.0>the 18th century</option>
                    <option value=19.0>the 19th century</option>
                    <option value=20.0>the 20th century</option>
                    <option value=21.0>the 21st century</option>
                    <option value="unknown">Unknown century</option>
                </select><br /><br />


                <label>Country:</label>
                <select id='country' , name="country" , onchange="submitSelected()">
                    <option value="">All</option>
                    <option value="Spain">Spain</option>
                    <option value="1">America</option>
                    <option value="2">Italy</option>
                    <option value="3">France</option>
                    <option value="4">China</option>
                    <option value="5">Japan</option>
                    <option value="6">England</option>
                    <option value="7">Netherlands</option>
                    <option value="8">Germany</option>
                    <option value="9">Austria</option>
                </select><br /><br />

                <label>Artwork Type:</label>
                <select id='artwork_type' , name="artwork_type" , onchange="submitSelected()">
                    <option value="">All</option>
                    <option value="abstract">Abstract</option>
                    <option value="advertisement">Advertisement</option>
                    <option value="aerophone-lip">Aerophone-lip</option>
                    <option value="albums|drawings">Albums|drawings</option>
                    <option value="allegorical painting">Allegorical painting</option>
                    <option value="animal painting">Animal painting</option>
                    <option value="architecture">Architecture</option>
                    <option value="armor for man">Armor for man</option>
                    <option value="audio">Audio</option>
                    <option value="battle painting">Battle painting</option>
                    <option value="bijinga">Bijinga</option>
                    <option value="bird-and-flower painting">Bird-and-flower painting</option>
                    <option value="book illustration">Book illustration</option>
                    <option value="books">Books</option>
                    <option value="calligraphy">Calligraphy</option>
                    <option value="capriccio">Capriccio</option>
                    <option value="caricature">Caricature</option>
                    <option value="ceramics">Ceramics</option>
                    <option value="chordophone">Chordophone</option>
                    <option value="cityscape">Cityscape</option>
                    <option value="cloudscape">Cloudscape</option>
                    <option value="coins">Coins</option>
                    <option value="crche">Crche</option>
                    <option value="design">Cesign</option>
                    <option value="drawings">Drawings</option>
                    <option value="emblem pictura">Emblem pictura</option>
                    <option value="facsimile">Facsimile</option>
                    <option value="figurative">Figurative</option>
                    <option value="film">Film</option>
                    <option value="flower painting">Flower painting</option>
                    <option value="furniture">Furniture</option>
                    <option value="furniture-wood">Furniture-wood</option>
                    <option value="genre painting">Genre painting</option>
                    <option value="glass">Glass</option>
                    <option value="glassware">Glassware</option>
                    <option value="graffiti">Graffiti</option>
                    <option value="graphics">Graphics</option>
                    <option value="helmets">Helmets</option>
                    <option value="history painting">History painting</option>
                    <option value="horology">Horology</option>
                    <option value="illumination">Illumination</option>
                    <option value="illustrated book">Illustrated book</option>
                    <option value="illustration">Illustration</option>
                    <option value="installation">Installation</option>
                    <option value="interior">Interior</option>
                    <option value="landscape">Landscape</option>
                    <option value="literary painting">Literary painting</option>
                    <option value="manuscript illumination">Manuscript illumination</option>
                    <option value="marina">Marina</option>
                    <option value="medals and plaquettes">Medals and plaquettes</option>
                    <option value="metalwork">Metalwork</option>
                    <option value="miniature">Miniature</option>
                    <option value="miscellaneous">Miscellaneous</option>
                    <option value="mosaic">Mosaic</option>
                    <option value="multiple">Multiple</option>
                    <option value="mythological painting">Mythological painting</option>
                    <option value="natural substances">N atural substances</option>
                    <option value="nude painting (nu)">Nude painting</option>
                    <option value="others">Others</option>
                    <option value="painting">Painting</option>
                    <option value="panorama">Panorama</option>
                    <option value="pastels & oil sketches on paper">Pastels & oil sketches on paper</option>
                    <option value="pastorale">Pastorale</option>
                    <option value="performance">Performance</option>
                    <option value="periodical">Periodical</option>
                    <option value="photo">Photo</option>
                    <option value="photograph">Photograph</option>
                    <option value="photographs">Photographs</option>
                    <option value="portfolios">Portfolios</option>
                    <option value="portrait">Portrait</option>
                    <option value="poster">Poster</option>
                    <option value="print">Print</option>
                    <option value="quadratura">Quadratura</option>
                    <option value="religious painting">Religious painting</option>
                    <option value="screens">Screens</option>
                    <option value="sculpture">Sculpture</option>
                    <option value="self-portrait">Self-portrait</option>
                    <option value="shan shui">Shan shui</option>
                    <option value="sketch and study">Sketch and study</option>
                    <option value="stained-glass">Stained-glass</option>
                    <option value="still life">Still life</option>
                    <option value="symbolic painting">Symbolic painting</option>
                    <option value="tapestry">Tapestry</option>
                    <option value="textiles">Textiles</option>
                    <option value="transparencies">Transparencies</option>
                    <option value="trompe-l\'il">Trompe</option>
                    <option value="unknown">unknown</option>
                    <option value="vanitas">Vanitas</option>
                    <option value="vases">Vases</option>
                    <option value="veduta">Veduta</option>
                    <option value="video">Video</option>
                    <option value="wildlife painting">Wildlife painting</option>
                    <option value="woodblocks">Woodblocks</option>
                    <option value="woodwork">Woodwork</option>
                </select><br /><br />

                <label>School:</label>
                <select id='school' , name="school" , onchange="submitSelected()">
                    <option value="">All</option>
                    <option value=unknown>Unknown</option>4
                    <option value="belgian">Belgian</option>
                    <option value="Italia">Italia</option>
                    <option value="italian">Italian</option>
                    <option value="glasgow">Glasgow</option>
                    <option value="london">London</option>
                    <option value="dutch">Dutch</option>
                    <option value="swedish">Swedish</option>
                    <option value="flemish">Flemish</option>
                    <option value="french">French</option>
                    <option value="japanese">Japanese</option>
                    <option value="german">German</option>
                    <option value="london; guildford [printed]">Guildford</option>
                    <option value="manchester">Manchester</option>
                    <option value="modern">Modern</option>
                    <option value="spanish">Spanish</option>
                    <option value="new york">New York</option>
                    <option value="british">British</option>
                    <option value="chinese">Chinese</option>
                    <option value="Deutschland">Europe</option>
                    <option value="london & new york">London & New York</option>
                    <option value="american">American</option>
                    <option value="austrian">Austrian</option>
                    <option value="english">English</option>
                    <option value="Nederland">Nederland</option>
                    <option value="paris">Paris</option>
                    <option value="munchen">Munchen</option>
                    <option value="budapest">Budapest</option>
                    <option value="melbourne">Melbourne</option>
                    <option value="netherlandish">Netherlandish</option>
                    <option value="Great Britain">Richmondshire</option>
                    <option value="russian">Russian</option>
                    <option value="greek">Greek</option>
                    <option value="danish">Danish</option>
                    <option value="john lane; boston">Josh Lane</option>
                    <option value="edinburgh">Edinburgh</option>
                    <option value="newcastle upon tyne">Newcastle</option>
                    <option value="France métropolitaine">France</option>
                    <option value="geneve">Geneve</option>
                    <option value="oxford">Oxford</option>
                    <option value="scottish">Scottish</option>
                    <option value="printed for the author; sold by a. millar">Printed A. millar</option>
                    <option value="chester">Chester</option>
                    <option value="hungarian">Hungarian</option>
                    <option value="a. millar">A. Millar</option>
                    <option value="Danmark">Danmark</option>
                    <option value="swiss">Swiss</option>
                    <option value="edinburgh and london">Edinburgh and London</option>
                    <option value="Other">Corozal</option>
                    <option value="toronto">Toronto</option>
                    <option value="johann heinrich rudigern">Johann Heinrich Rudigern</option>
                    <option value="westminster">Westminster</option>
                    <option value="cambridge">london [printed]</option>
                    <option value="sydney">Sydney</option>
                    <option value="norwegian"></option>
                    <option value="polish">Polish</option>
                    <option value="bohemian">Bohemian</option>
                    <option value="other">Other</option>
                    <option value="Sverige">Sverige</option>
                    <option value="Scotland">UK</option>
                    <option value="United States of America">United States of America</option>
                </select><br /><br />

                <label>General Type:</label>
                <select id='general_type' , name="general_type" , onchange="submitSelected()">
                    <option value="">All</option>
                    <option value="craft">Craft</option>
                    <option value="design">Design</option>
                    <option value="drawing">Drawing</option>
                    <option value="installation">Installation</option>
                    <option value="new media">New Media</option>
                    <option value="mixed media">Mixed Media</option>
                    <option value="performance art">Performance Art</option>
                    <option value="weapons and armor">Weapons and Armor</option>
                    <option value="painting">Painting</option>
                    <option value="photograph">Photograph</option>
                    <option value="print">Print</option>
                    <option value="sculputure">Sculpture</option>
                    <option value="textile">Textile</option>
                    <option value="unknown">Unknown</option>
                </select><br /><br />
                <button type="submit">Sumbit</button><br>
                <script type="text/javascript" src="static/js/cielab.js"></script>
                <script type="text/javascript" src="static/js/volume.js"></script>
                <script type="text/javascript" src="static/js/graph.js"></script>
        </nav>
        <main role="main" class="col-10">
            <div class="row mt-4">
                <div class="col-6">
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div id="cielab-view">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div id="barchart-view" class="barchart-view" style="width: 700px; height: 540px; overflow-y: scroll"></div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div id="volume-view"></div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div id="graph-view"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<div id="tooltip"></div>
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<div id="help-tooltip"></div>
<script type="text/javascript" src="static/js/cielab.js"></script>
<script type="text/javascript" src="static/js/barchart.js"></script>
<script type="text/javascript" src="static/js/volume.js"></script>
<script type="text/javascript" src="static/js/graph.js"></script>
<script type="text/javascript" src="static/js/helpTooltip.js"></script>
<script type="text/javascript">
    var CIELAB = '#cielab-view',
        BARCHART = '#barchart-view',
        VOLUME = '#volume-view',
        GRAPH = '#graph-view',
        TOOLTIP = '#tooltip';
        HELP_TOOLTIP = '#help-tooltip';

    function deepEqual(x, y) {
        const ok = Object.keys, tx = typeof x, ty = typeof y;
        return x && y && tx === 'object' && tx === ty ? (
            ok(x).length === ok(y).length &&
            ok(x).every(key => deepEqual(x[key], y[key]))
        ) : (x === y);
    }

    window.onload = () => {

        ws.onopen = () => {
            ws.send(JSON.stringify(parameters))
            console.log("Socket open")
        };

        cielab_view();
        volume_view();
        graph_view();
        barchart_view();
    }
    
    // event emmited when receiving message 
    var ws = new WebSocket('ws://localhost:40510');

    var parameters = {
        artist_nationality : document.getElementById('country').value,
        artwork_type: document.getElementById('artwork_type').value,
        school: document.getElementById('school').value,
        general_type: document.getElementById('general_type').value,
        creation_year: { begin: 1614, end: 1714 }
    }

    ws.onmessage = (ev) => {
        new_data = JSON.parse(ev.data);

        if (typeof data == "undefined" || !deepEqual(data, new_data)) {
            data = new_data;
            console.log('Updating graphs');
            update_cielab(data);
            update_graph(data);
            update_volume(data);
            update_barchart(data);
        }
    }

    // Slider
    var slider = createD3RangeSlider(-400, 2021, "#container", true);
    slider.range(parameters["creation_year"]["begin"], parameters["creation_year"]["end"]);
    slider.onChange(function (newRange) {
        d3.select("#range-label").html(newRange.begin + " &mdash; " + newRange.end);
        range = slider.range()
        parameters["creation_year"]["begin"] = range["begin"]
        parameters["creation_year"]["end"] = range["end"]
        console.log(parameters["creation_year"])
        ws.send(JSON.stringify(parameters))
    });
</script>